<!--To run npm local server: http-server . -p 8000-->
<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>CG - 2019/1 - Torus.</title>
		<style>
			body { margin: 0;}
			canvas { width: 100%; height: 100%; }
		</style>
	</head>
	<body>
		<div id="menu" style="color:white; position: absolute;top: 10px; width: 100%; text-align: left; z-index: 100;display:block;"> 
			Press 1 to draw Torus, 2 to draw Cylinder, 3 to draw Cone, 4 to draw Sphere, T to aply/remove texture, N to draw/remove normal axis
		</div>
		<div id="container"></div>
	<!-- three.js -->
	<script src="js/build/three.js"></script>
	
	<!-- incluir biblioteca de interface gráfica -->
	<script src="js/examples/js/libs/dat.gui.min.js"></script>
	
	<!-- incluir a biblioteca do trackball -->
	<script src="js/examples/js/controls/TrackballControls.js"></script>

	<!-- incluir a biblioteca stats -->
	<script src="js/examples/js/libs/stats.min.js"></script>

	<script>

	var clock, scene, camera,renderer, trackballControls;
	var controls,gui;
	var mesh, geometry;
	var container, stats;

	var geometries = [
				new THREE.TorusBufferGeometry( 1, 0.3, 10, 25 ),											  
				new THREE.CylinderBufferGeometry( 75, 75, 200, 8, 8 ),
				new THREE.ConeBufferGeometry( 5, 20, 32 ),
				new THREE.SphereBufferGeometry( 100, 12, 12 )
			];

	var options = {
		Geometry: 0
	};

	var emptymaterial = new THREE.MeshBasicMaterial( { color: 0xfefefe, wireframe: true, opacity: 0.5 } );

	var textureOn = false

	var normalAxesOn = false

	//Textura
	var texture = new THREE.TextureLoader().load( 'velazquez_texture_256.jpg' );
	var textureMap = new THREE.MeshBasicMaterial( { map: texture }  );

	function addMesh(material)
	{
		if ( mesh !== undefined ) {
					
			scene.remove( mesh );
			geometry.dispose();

		}

		geometry = geometries[ options.Geometry ];

		// scale geometry to a uniform size

		geometry.computeBoundingSphere();

		var scaleFactor = 160 / geometry.boundingSphere.radius;
		geometry.scale( scaleFactor, scaleFactor, scaleFactor );

		mesh = new THREE.Mesh( geometry, material );
		scene.add( mesh );
		
		if(normalAxesOn){
			var vertexNormalsHelper = new THREE.VertexNormalsHelper( mesh, 10 );
			mesh.add( vertexNormalsHelper );
		}
		
	}

	function init()
	{
		container = document.getElementById( 'container' );
		//variável que armazena instantes de tempo da aplicação
		clock = new THREE.Clock();
		
		//cena
		scene = new THREE.Scene();
		
		//camera
		camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        //posicionar a câmera
        camera.position.x = 200;
        camera.position.y = 200;
		camera.position.z = 200;
		
		//renderer
		renderer = new THREE.WebGLRenderer({ antialias: true } );
		renderer.setPixelRatio( window.devicePixelRatio );									  
		renderer.setSize( window.innerWidth, window.innerHeight );
		document.body.appendChild(renderer.domElement);
		
		/*******************TRACKBALL**********************/
		/**************************************************/
		trackballControls = new THREE.TrackballControls(camera, renderer.domElement);
		trackballControls.rotateSpeed = 5.0;
		trackballControls.zoomSpeed = 1.0;
		trackballControls.panSpeed = 1.0;

		//adicionar eixos
		var axes = new THREE.AxisHelper(200);
		scene.add(axes);
		
		addMesh(emptymaterial);

		var geometries = {
			TorusBufferGeometry: 0,
			CylinderBufferGeometry: 1,
			ConeBufferGeometry: 2,
			SphereBufferGeometry: 3
		};

		gui = new dat.GUI( { width: 350 } );
		
		// Opções de Geometria //
		gui.add( options, 'Geometry', geometries ).onChange( function () {
			addMesh(emptymaterial);
		});

		animate();
	}

	document.onkeydown = function(e){
		switch(e.key){
			case "1":
				options.Geometry = 0
				if(textureOn){
					addMesh(textureMap)
				}
				else{
					addMesh(emptymaterial)
				}			
				console.log("torus")
				break;
			case "2":
				options.Geometry = 1
				if(textureOn){
					addMesh(textureMap)
				}
				else{
					addMesh(emptymaterial)
				}
				console.log("cilindro")
				break;
			case "3":
				options.Geometry = 2
				if(textureOn){
					addMesh(textureMap)
				}
				else{
					addMesh(emptymaterial)
				}
				console.log("cone")
				break;
			case "4":
				options.Geometry = 3
				if(textureOn){
					addMesh(textureMap)
				}
				else{
					addMesh(emptymaterial)
				}
				console.log("esfera")
				break;
			case "t":
				workOnTexture()
				break;
			case "T":
				workOnTexture()
				break;
			case "n":
				workOnNormalAxes()
				break;
			case "N":
				workOnNormalAxes()
				break;
		}
	}

	function workOnTexture(){
		// Remover textura caso já esteja aplicada
		if(!textureOn){
			textureOn=true
			addMesh(textureMap)
		}
		else{
			textureOn = false
			addMesh(emptymaterial)
		}
	}

	function workOnNormalAxes(){
		normalAxesOn = !normalAxesOn;
		if(textureOn){
			addMesh(textureMap)
		}
		else{
			addMesh(emptymaterial)
		}
	}

	function animate()
	{
		//<!--tempo passado entre o último frame e o frame atual-->
		var delta = clock.getDelta();
		
		//<!-- atualiza posição da câmera -->
		trackballControls.update(delta);
	
		requestAnimationFrame(animate);
		//torus.rotation.x += 0.1;
		//torus.rotation.y += 0.1;
		renderer.render(scene, camera);
	}

	window.onload = init;
	</script>
	</body>
</html>